<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pottel Mutton Order ‚Äì M&M Agro Farms</title>
  <style>
    body {
      font-family: Arial; background: #f0fff0;
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; padding: 0;
    }
    .form-container {
      background: #d4edda; padding: 20px; border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15); width: 90%; max-width: 420px;
      position: relative;
    }
    .offer {
      position: absolute; top: -10px; right: -10px;
      background: #ff6347; color: #fff; font-weight: bold;
      padding: 8px 14px; border-radius: 20px; font-size: 14px;
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse {
      0% {transform: scale(1);}
      50% {transform: scale(1.1);}
      100% {transform: scale(1);}
    }
    h2 { text-align: center; color: #155724; margin-bottom: 20px; }
    label { font-weight: bold; color: #155724; margin-top: 10px; display: block; }
    input, textarea {
      width: 100%; padding: 8px; margin-top: 5px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;
    }
    button {
      margin-top: 16px; padding: 10px; width: 100%;
      background: #28a745; color: white; font-size: 16px;
      border: none; border-radius: 8px; cursor: pointer;
    }
    button:hover { background: #218838; }
    .total-box {
      margin-top: 10px; font-weight: bold; font-size: 16px; color: #000;
    }
    .message {
      margin-top: 20px; color: #155724; font-weight: bold;
    }
    .order-copy {
      width: 100%; resize: vertical; font-family: monospace;
      font-size: 14px; margin-top: 10px;
    }
    #shareButton {
      background: #25d366;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="form-container">
  <div class="offer">Offer: ‚Çπ850/Kg</div>
  <h2>Pottel Mutton Order</h2>

  <form id="orderForm">
    <label for="name">Name</label>
    <input type="text" id="name" required oninput="this.value = this.value.toUpperCase()">

    <label for="mobile">Mobile No</label>
    <input type="tel" id="mobile" maxlength="10" pattern="\d{10}" required>

    <label for="quantity">Quantity (Kg)</label>
    <input type="number" id="quantity" required min="0.5" step="0.5">

    <label for="address">Delivery Address</label>
    <textarea id="address" required></textarea>

    <label for="datetime">Preferred Date & Time</label>
    <input type="datetime-local" id="datetime" required>

    <label for="notes">Additional Notes</label>
    <textarea id="notes" placeholder="e.g. Call before delivery..."></textarea>

    <div class="total-box">Total: ‚Çπ<span id="total">0.00</span></div>

    <button type="submit">Submit Order</button>
  </form>

  <div class="message" id="responseMsg"></div>
  <button id="shareButton" style="display:none;">üì§ Share Order via WhatsApp</button>
</div>

<script>
  const pricePerKg = 850;
  const form = document.getElementById("orderForm");
  const totalSpan = document.getElementById("total");
  const responseMsg = document.getElementById("responseMsg");
  const shareBtn = document.getElementById("shareButton");

  let orderDetails = "";
  let orderID = "";
  const ownerWhatsApp = "918688014021"; // your number (owner)

  document.getElementById("quantity").addEventListener("input", () => {
    const qty = parseFloat(document.getElementById("quantity").value) || 0;
    totalSpan.textContent = (qty * pricePerKg).toFixed(2);
  });

  function isAllowedTime() {
    const now = new Date(), d = now.getDay(), h = now.getHours();
    return !(d === 0 && h < 6 || d === 6 && h >= 21);
  }

  function generateOrderID() {
    return "MM" + Math.floor(100000 + Math.random() * 900000);
  }

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const qty = parseFloat(document.getElementById("quantity").value);
    const address = document.getElementById("address").value.trim();
    const datetime = document.getElementById("datetime").value.trim();
    const notes = document.getElementById("notes").value.trim();
    const total = qty * pricePerKg;

    if (!name || !mobile || isNaN(qty) || !address || !datetime || mobile.length !== 10) {
      alert("Please fill all required fields correctly.");
      return;
    }

    const now = new Date();
    const selectedDate = new Date(datetime);
    if (now.getDay() === 0 && selectedDate.toDateString() === now.toDateString()) {
      responseMsg.innerHTML = "‚ùå Sunday delivery must be booked by Saturday 9 PM.";
      return;
    }

    if (!isAllowedTime()) {
      responseMsg.innerHTML = "‚õî Orders are accepted only from Sunday 6 AM to Saturday 9 PM.";
      return;
    }

    orderID = generateOrderID();

    orderDetails = 
`*üåø M&M Agro Farms ‚Äì Pottel Mutton Order*
üÜî Order ID: ${orderID}
üë§ Name: ${name}
üìû Mobile: +91${mobile}
üì¶ Quantity: ${qty} Kg
üí∞ Total: ‚Çπ${total.toFixed(2)}
üìç Address: ${address}
üïì Delivery: ${datetime}
üìù Notes: ${notes || "None"}
‚úÖ Thank you for choosing M&M Agro Farms!`;

    const confirmMsg = `Please confirm your order:\n\n${orderDetails.replace(/\*/g, "")}`;
    if (!confirm(confirmMsg)) return;

    // 1. Send to Owner WhatsApp
    window.open(`https://wa.me/${ownerWhatsApp}?text=${encodeURIComponent(orderDetails)}`, "_blank");

    // 2. Show confirmation and share option
    responseMsg.innerHTML = `
      ‚úÖ Your order has been submitted successfully.<br><br>
      You can save or forward your order details below:<br>
      <textarea class="order-copy" rows="8" readonly>${orderDetails}</textarea>
    `;
    shareBtn.style.display = "block";

    // Reset form
    form.reset();
    totalSpan.textContent = "0.00";
  });

  // Share with friend / self
  shareBtn.addEventListener("click", () => {
    const shareTo = prompt("Enter a WhatsApp number to share (without +):", "91");
    if (shareTo) {
      window.open(`https://wa.me/${shareTo}?text=${encodeURIComponent(orderDetails)}`, "_blank");
    }
  });
</script>

</body>
</html>
